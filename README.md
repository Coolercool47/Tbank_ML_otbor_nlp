# Классификация категорий товаров по отзывам с помощью LLM

## Цель кейса

Научить LLM-модель классифицировать отзывы по категориям товаров, к которым они относятся.

### Ключевые задачи:
*   **Качество:** Модель должна как можно лучше классифицировать тестовые отзывы по метрике `Weighted F1`.
*   **Скорость:** Время классификации одного примера не должно превышать `5` секунд в среднем.
*   **Категории:** `бытовая техника`, `обувь`, `одежда`, `посуда`, `текстиль`, `товары для детей`, `украшения и аксессуары`, `электроника`, `нет товара`.

## Описание решения

Данное решение представляет собой комплексный пайплайн, который решает проблему классификации отзывов в условиях сильного дисбаланса классов и отсутствия начальной разметки.

Ключевая идея — использовать большую генеративную модель (**Qwen3-14B**) для автоматической разметки и создания качественных синтетических данных, а затем обучить на этих данных более быструю и эффективную encoder-only модель (**xlm-roberta-large**) для финальной классификации.

### Итоговые результаты:
*   **Weighted F1-score на валидационной выборке:** **0.82**
*   **Среднее время инференса на 1 пример (GPU T4): ~0.014 секунды** (что в ~350 раз быстрее требуемого лимита).

## Пайплайн решения

Весь процесс разделен на 5 ключевых этапов, реализованных в предоставленных ноутбуках.

### Этап 1: Автоматическая разметка данных (Zero-Shot Labeling)

Поскольку исходные данные не были размечены, первым шагом стала их автоматическая раз-метка.

1.  **Выбор модели:** После неудачной попытки использования encoder-only модели (`mDeBERTa-v3-base`), которая показала низкую надежность (~40% сомнительных предсказаний), была выбрана мощная decoder-only модель **`Qwen/Qwen3-14B`**.
2.  **Оптимизация:** Для запуска 14B-модели в рамках ограничений Google Colab (16GB VRAM) была использована библиотека `unsloth` с 4-битной квантизацией.
3.  **Промпт-инжиниринг:** Был разработан итеративный промпт со строгой структурой вывода, чтобы обеспечить стабильное и легко парсируемое качество разметки.

**Финальный промпт для разметки:**
```
Ты — точный ИИ-классификатор отзывов. Твоя задача — вернуть категорию и пояснение в СТРОГОМ формате.

**Категории на выбор:**
- бытовая техника
- обувь
- одежда
- посуда
- текстиль
- товары для детей
- украшения и аксессуары
- электроника
- нет товара

**СТРОГИЕ ПРАВИЛА:**
1.  Выбирай категорию "нет товара", если в отзыве говорится только о доставке, оплате, спорах или общих фразах ("все хорошо").
2.  Опирайся ТОЛЬКО на слова в тексте. Не додумывай.
3.  В строке `КАТЕГОРИЯ:` должно быть ТОЛЬКО одно название из списка выше. Никаких лишних слов вроде "среди" или "похоже на".
4.  Твой ответ ДОЛЖЕН СТРОГО следовать формату с метками `КАТЕГОРИЯ:` и `ПОЯСНЕНИЕ:`.

---

**Примеры формата, которому ты должен следовать:**

**Пример 1:**
*Отзыв:* "Платье красивое, но с размером не угадала."
*Твой ответ:*
КАТЕГОРИЯ: одежда
ПОЯСНЕНИЕ: В отзыве упоминается "платье", что напрямую указывает на категорию "одежда".

**Пример 2:**
*Отзыв:* "Посылку так и не доставили, поддержка молчит."
*Твой ответ:*
КАТЕГОРИЯ: нет товара
ПОЯСНЕНИЕ: В отзыве говорится только о проблемах с доставкой, а не о самом товаре.

**Пример 3:**
*Отзыв:* "Купил новые кроссовки для бега, очень удобные."
*Твой ответ:*
КАТЕГОРИЯ: обувь
ПОЯСНЕНИЕ: Ключевое слово "кроссовки" однозначно относится к категории "обувь".
Классифицируй отзыв 
*отзыв*
```
### Этап 2: Анализ данных и выявление проблемы

После разметки был проведен анализ данных с помощью `sbert_large_nlu_ru` для получения эмбеддингов и `UMAP` для визуализации.

*   **Вывод:** Обнаружен **критический дисбаланс классов**. Более 90% отзывов относятся к категориям **"одежда"** и **"нет товара"**. Остальные 7 категорий практически не представлены.
*   **Решение:** Обучение на таких данных приведет к смещенной модели. Было принято решение **сгенерировать синтетические данные** для редких классов.

#### Визуализация эмбеддингов исходных данных
*Примечание: GitHub не отображает PDF напрямую в Markdown. Рекомендуется конвертировать их в PNG или JPG для вставки изображений, либо оставить просто ссылки на PDF-файлы.*

*   **График 1:** Распределение эмбеддингов только для размеченного train-датасета.
    *   [Ссылка на `original_data.pdf`](./graphs/original_data.pdf)
    *   ![Визуализация исходных данных](./graphs/original_data.png)

